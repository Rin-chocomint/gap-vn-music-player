<title>Selamat dateng di GAP vn & Music Player!</title>
<div class="custom-title-bar">
    <span class="title-bar-text">Selamat dateng di GAP vn & Music Player!</span>
</div>

<div id="info-popup" class="popup">
    <div class="popup-content">
        <div class="popup-header">
            <img src="./aset/ikon.jpg" alt="Icon" class="popup-icon">
            <div class="header-text">
                <h2 class="popup-title">Informasi Proyek</h2>
                <p class="popup-description">
                    Penting! Proyek ini belum sepenuhnya selesai!, beberapa aspek dasar musik player & visual novel baru
                    implementasikan secara dasar, belum di sempurnakan dan optimalisasi yang apala-kadarnya saja, dan
                    kemungkinan masih ada
                    hal kecil yang belum di perbaiki.
                </p>
                <p class="popup-description">
                    Pilih opsi boot ke "Game" untuk menikmati estetika Aplikasi serta game Visual Novel, atau Jika hanya
                    mau mendengarkan musik, boot ke "Native ytMusic webview" untuk Power Effisiensi.
                </p>
            </div>
        </div>

        <div class="popup-main">
            <!-- Boot Mode Selection -->
            <div class="option-group">
                <label for="boot-mode-select" style="margin-bottom: 5px;">Boot to :</label>
                <div style="display: flex; align-items: center; width: 100%;">
                    <select id="boot-mode-select" onchange="toggleBootOptions()" style="margin-right: 10px;">
                        <option value="game">Game (VN & Music Player)</option>
                        <option value="native">Native ytMusic webview</option>
                        <option value="gif-overlay">GIF Overlay Only</option>
                    </select>

                    <!-- Quick Boot Trigger -->
                    <span id="quick-boot-trigger"
                        style="display:none; font-size: 11px; cursor: pointer; color: #555; text-decoration: underline; white-space: nowrap;">
                        buat quick boot dari setting saat ini?
                    </span>
                    <span id="quick-boot-help" style="display:none; margin-left: 5px; cursor: help; font-size: 12px;"
                        title="Membuat shortcut di desktop yang langsung menjalankan aplikasi dengan opsi yang dipilih saat ini.">
                        ‚ùì
                    </span>
                </div>
            </div>

            <!-- Game Mode Options -->
            <div id="game-mode-options">
                <div class="option-group">
                    <label for="skip-scene-checkbox">
                        <input type="checkbox" id="skip-scene-checkbox">
                        Skip Scene?
                    </label>

                    <label for="fullscreen-checkbox">
                        <input type="checkbox" id="fullscreen-checkbox">
                        Fullscreen Mode?
                    </label>
                </div>

                <div class="option-group">
                    <label for="playlist-select">Select Playlist:</label>
                    <select id="playlist-select"></select>
                </div>

                <div class="option-group">
                    <label for="wallpaper-select">Select Wallpaper:</label>
                    <select id="wallpaper-select"></select>
                </div>
            </div>
        </div>


        <div class="popup-footer">
            <p class="popup-warning">
                <strong>Perhatian: </strong>Jangan pernah mau disuruh mengganti file kode Aplikasi oleh orang lain Jika
                kamu tidak tahu apa yang sedang kamu lakukan itu terhadap file kode aplikasi!
            </p>
            <button id="popup-ok-button">OK</button>
        </div>
    </div>
</div>

<!-- Quick Boot Modal -->
<div id="quick-boot-modal" class="popup"
    style="display: none; z-index: 10001; background: rgba(0,0,0,0.5); width: 100%; height: 100%;">
    <div class="popup-content" style="width: 320px; border-radius: 8px;">
        <h3 style="margin-top: 0; font-size: 16px;">Buat Quick Boot</h3>
        <p style="font-size: 12px; color: #666; margin-bottom: 15px;">Konfigurasi ini akan disimpan sebagai shortcut
            desktop.</p>

        <div class="option-group" style="width: 100%; margin-bottom: 10px;">
            <label style="font-size: 12px; font-weight: bold;">Nama Shortcut:</label>
            <input type="text" id="qb-name" placeholder="Misal: Mode Musik Only"
                style="width: 100%; padding: 6px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div class="option-group" style="width: 100%; margin-bottom: 15px;">
            <!-- Simplified Icon Selection -->
            <label style="font-size: 12px; font-weight: bold;">Ikon (harus format .ico): <span
                    style="font-weight: normal; color: #888;">(Opsional)</span></label>
            <div style="display: flex; gap: 5px; width: 100%;">
                <input type="text" id="qb-icon" placeholder="Biarkan kosong untuk default"
                    style="flex-grow: 1; padding: 6px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 11px;">
                <button id="qb-browse-btn"
                    style="padding: 0 10px; border: 1px solid #ccc; background: #eee; border-radius: 4px; cursor: pointer; font-size: 11px;">Browse</button>
            </div>
        </div>

        <!-- Summary of settings -->
        <div
            style="background: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 11px; border: 1px solid #eee; text-align: left;">
            <strong style="display: block; margin-bottom: 5px;">Akan boot dengan setting:</strong>
            <ul id="qb-summary" style="padding-left: 20px; margin: 0; line-height: 1.4; color: #444;"></ul>
        </div>

        <div class="popup-footer" style="margin-top: 10px; border: none; padding-bottom: 0;">
            <button id="qb-cancel"
                style="background: #ccc; margin-right: 10px; padding: 8px 15px; border:none; border-radius:4px; cursor:pointer;">Batal</button>
            <button id="qb-save"
                style="background: #28a745; color: white; padding: 8px 15px; border:none; border-radius:4px; cursor:pointer;">Buat
                Shortcut</button>
        </div>
    </div>
</div>

<style>
    .popup {
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    }

    .popup-content {
        background: white;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        padding: 10px;
        font-family: 'Lexend', sans-serif;
        color: black;
    }

    .popup-header {
        display: flex;
        align-items: center;
    }

    .popup-icon {
        width: 50px;
        height: 50px;
        margin-right: 15px;
    }

    .header-text {
        flex-grow: 1;
    }

    .popup-title {
        font-size: 19px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .popup-description {
        font-size: 13px;
        color: #666;
    }

    .popup-main {
        margin: 7px 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .option-group {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    #game-mode-options {
        transition: opacity 0.3s ease;
    }

    .option-group label {
        font-size: 14px;
    }

    select {
        padding: 5px;
        font-size: 14px;
        width: 100%;
        max-width: 300px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    input[type="checkbox"] {
        margin-right: 10px;
    }

    .popup-main label {
        font-size: 14px;
    }

    .popup-footer {
        border-top: 1px solid #ccc;
        margin-top: 20px;
        padding-bottom: 20px;
        text-align: center;
    }

    .popup-warning {
        color: red;
        font-size: 14px;
        margin-bottom: 10px;
    }

    #popup-ok-button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
    }

    #popup-ok-button:hover {
        background: #0056b3;
    }

    @font-face {
        font-family: 'Lexend';
        font-style: normal;
        font-weight: 300;
        src: url('./aset/fonts/lexend-v26-latin-300.woff2') format('woff2');
    }

    @font-face {
        font-family: 'Lexend';
        font-style: normal;
        font-weight: 400;
        src: url('./aset/fonts/lexend-v26-latin-regular.woff2') format('woff2');
    }

    @font-face {
        font-family: 'Lexend';
        font-style: normal;
        font-weight: 700;
        src: url('./aset/fonts/lexend-v26-latin-700.woff2') format('woff2');
    }
</style>

<script>
    const { ipcRenderer } = require('electron');
    let skipScene = false;

    // Toggle Options based on Boot Mode
    window.toggleBootOptions = function () {
        const mode = document.getElementById('boot-mode-select').value;
        const gameOptions = document.getElementById('game-mode-options');
        const inputs = gameOptions.querySelectorAll('input, select');

        if (mode === 'native' || mode === 'gif-overlay') {
            // Samarkan opsi game mode untuk native dan gif-overlay
            gameOptions.style.opacity = '0.3';
            gameOptions.style.pointerEvents = 'none';
            inputs.forEach(input => input.disabled = true);
        } else {
            // Tampilkan kembali untuk mode game
            gameOptions.style.opacity = '1';
            gameOptions.style.pointerEvents = 'auto';
            inputs.forEach(input => input.disabled = false);
        }
        showQuickBootTrigger();
    }

    // --- Quick Boot Logic ---
    const qbTrigger = document.getElementById('quick-boot-trigger');
    const qbHelp = document.getElementById('quick-boot-help');

    function showQuickBootTrigger() {
        if (qbTrigger.style.display === 'none') {
            qbTrigger.style.display = 'inline';
            qbHelp.style.display = 'inline';
        }
    }

    // Attach listeners to all inputs to trigger the button appearance
    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('change', showQuickBootTrigger);
        el.addEventListener('input', showQuickBootTrigger);
    });

    qbTrigger.addEventListener('click', () => {
        // Populate Summary
        const summaryList = document.getElementById('qb-summary');
        summaryList.innerHTML = '';

        const mode = document.getElementById('boot-mode-select').value;
        const modeNames = {
            'native': 'Native ytMusic',
            'game': 'Game (VN & Music Player)',
            'gif-overlay': 'GIF Overlay Only'
        };
        let items = [`Mode: ${modeNames[mode] || mode}`];

        if (mode === 'game') {
            if (document.getElementById("skip-scene-checkbox").checked) items.push("Skip Scene: Ya");
            if (document.getElementById("fullscreen-checkbox").checked) items.push("Fullscreen: Ya");
            const pl = document.getElementById("playlist-select").value;
            if (pl) items.push(`Playlist: ${pl}`);
            const wp = document.getElementById("wallpaper-select").value;
            if (wp) items.push(`Wallpaper: ${wp}`);
        }

        items.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            summaryList.appendChild(li);
        });

        document.getElementById('quick-boot-modal').style.display = 'flex';
    });

    document.getElementById('qb-cancel').addEventListener('click', () => {
        document.getElementById('quick-boot-modal').style.display = 'none';
    });

    document.getElementById('qb-browse-btn').addEventListener('click', async () => {
        const path = await ipcRenderer.invoke('dialog-select-icon');
        if (path) {
            document.getElementById('qb-icon').value = path;
        }
    });

    document.getElementById('qb-save').addEventListener('click', () => {
        const name = document.getElementById('qb-name').value || 'Gap Player Quick Boot';
        let icon = document.getElementById('qb-icon').value;
        if (!icon || icon.trim() === '') {
            icon = 'aset/icon.ico';
        }

        const mode = document.getElementById('boot-mode-select').value;
        const settings = {
            mode: mode
        };

        // Hanya sertakan opsi game jika mode adalah 'game'
        if (mode === 'game') {
            settings.skipScene = document.getElementById("skip-scene-checkbox").checked;
            settings.selectedPlaylist = document.getElementById("playlist-select").value;
            settings.selectedWallpaper = document.getElementById("wallpaper-select").value;
            settings.fullscreenMode = document.getElementById("fullscreen-checkbox").checked;
        }

        ipcRenderer.send('create-quick-boot', {
            name,
            icon,
            settings
        });

        const saveBtn = document.getElementById('qb-save');
        const originalText = saveBtn.innerText;
        saveBtn.innerText = 'Sedang membuat...';
        saveBtn.disabled = true;

        // Tunggu balasan dari main process
        ipcRenderer.once('quick-boot-status', (event, { success, message }) => {
            alert(message);
            saveBtn.innerText = originalText;
            saveBtn.disabled = false;

            if (success) {
                document.getElementById('quick-boot-modal').style.display = 'none';
            }
        });
    });
    // --- End Quick Boot Logic ---

    // Kirim data pilihan pengguna ke main.js
    document.getElementById('popup-ok-button').addEventListener('click', () => {

        const mode = document.getElementById('boot-mode-select').value;

        if (mode === 'native') {
            ipcRenderer.send('open-main-window', {
                mode: 'native'
                // Default settings akan di-handle oleh main.js dan native-player.html
            });
        } else if (mode === 'gif-overlay') {
            // Mode GIF Overlay - hanya menampilkan panel kontrol GIF
            ipcRenderer.send('open-main-window', {
                mode: 'gif-overlay'
            });
        } else {
            ipcRenderer.send('open-main-window', {
                mode: 'game',
                skipScene: document.getElementById("skip-scene-checkbox").checked,
                selectedPlaylist: document.getElementById("playlist-select").value,
                selectedWallpaper: document.getElementById("wallpaper-select").value,
                fullscreenMode: document.getElementById("fullscreen-checkbox").checked
            });
        }
    });

    ipcRenderer.on("fullscreen-status-changed", (event, status) => {
        document.getElementById("fullscreen-checkbox").checked = status;
    });


    document.getElementById("fullscreen-checkbox").addEventListener("change", (event) => {
        ipcRenderer.send("toggle-fullscreen");
    });

    // Menerima data dari main.js untuk dropdown
    ipcRenderer.on('populate-dropdowns', (event, data) => {
        const { playlists, wallpapers } = data;

        const playlistSelect = document.getElementById('playlist-select');
        const wallpaperSelect = document.getElementById('wallpaper-select');

        playlists.forEach(playlist => {
            const option = document.createElement('option');
            option.value = playlist;
            option.textContent = playlist;
            playlistSelect.appendChild(option);
        });

        wallpapers.forEach(wallpaper => {
            const option = document.createElement('option');
            option.value = wallpaper;
            option.textContent = wallpaper;
            wallpaperSelect.appendChild(option);
        });
    });
</script>